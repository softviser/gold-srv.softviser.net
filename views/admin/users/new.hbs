<div class="d-flex justify-content-between align-items-center mb-4">
    <h2>Yeni Kullanıcı Ekle</h2>
    <a href="/admin/users" class="btn btn-outline-secondary">
        <i class="bi bi-arrow-left"></i>
        Geri Dön
    </a>
</div>

<div class="card">
    <div class="card-body">
        <form method="POST" action="/admin/users">
            <div class="row">
                <div class="col-md-6">
                    <div class="mb-3">
                        <label for="firstName" class="form-label">Ad *</label>
                        <input type="text" class="form-control" id="firstName" name="firstName" 
                               value="{{formData.firstName}}" required>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="mb-3">
                        <label for="lastName" class="form-label">Soyad *</label>
                        <input type="text" class="form-control" id="lastName" name="lastName" 
                               value="{{formData.lastName}}" required>
                    </div>
                </div>
            </div>
            
            <div class="row">
                <div class="col-md-6">
                    <div class="mb-3">
                        <label for="email" class="form-label">Email *</label>
                        <input type="email" class="form-control" id="email" name="email" 
                               value="{{formData.email}}" required>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="mb-3">
                        <label for="phone" class="form-label">Telefon</label>
                        <input type="tel" class="form-control" id="phone" name="phone" 
                               value="{{formData.phone}}" placeholder="+90 555 000 0000">
                    </div>
                </div>
            </div>
            
            <div class="row">
                <div class="col-md-6">
                    <div class="mb-3">
                        <label for="password" class="form-label">Şifre *</label>
                        <input type="password" class="form-control" id="password" name="password" required>
                        <div class="form-text">En az 6 karakter olmalıdır</div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="mb-3">
                        <label for="confirmPassword" class="form-label">Şifre Tekrar *</label>
                        <input type="password" class="form-control" id="confirmPassword" name="confirmPassword" required>
                    </div>
                </div>
            </div>
            
            <div class="row">
                <div class="col-md-6">
                    <div class="mb-3">
                        <label for="role" class="form-label">Rol *</label>
                        <select class="form-select" id="role" name="role" required>
                            <option value="">Rol seçin</option>
                            <option value="user" {{#if (eq formData.role 'user')}}selected{{/if}}>User</option>
                            <option value="manager" {{#if (eq formData.role 'manager')}}selected{{/if}}>Manager</option>
                            <option value="admin" {{#if (eq formData.role 'admin')}}selected{{/if}}>Admin</option>
                        </select>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="mb-3">
                        <label for="department" class="form-label">Departman</label>
                        <input type="text" class="form-control" id="department" name="department" 
                               value="{{formData.department}}" placeholder="IT, Finans, Operasyon vb.">
                    </div>
                </div>
            </div>
            
            <div class="mb-3">
                <label for="title" class="form-label">Ünvan</label>
                <input type="text" class="form-control" id="title" name="title" 
                       value="{{formData.title}}" placeholder="Sistem Yöneticisi, Analisti vb.">
            </div>
            
            <div class="mb-3">
                <label class="form-label">İzinler</label>
                <div class="row">
                    <div class="col-md-3">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="perm_read" name="permissions" value="read" checked>
                            <label class="form-check-label" for="perm_read">Okuma</label>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="perm_write" name="permissions" value="write">
                            <label class="form-check-label" for="perm_write">Yazma</label>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="perm_delete" name="permissions" value="delete">
                            <label class="form-check-label" for="perm_delete">Silme</label>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="perm_manage_users" name="permissions" value="manage_users">
                            <label class="form-check-label" for="perm_manage_users">Kullanıcı Yönetimi</label>
                        </div>
                    </div>
                </div>
                <div class="row mt-2">
                    <div class="col-md-3">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="perm_manage_sources" name="permissions" value="manage_sources">
                            <label class="form-check-label" for="perm_manage_sources">Kaynak Yönetimi</label>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="perm_manage_mappings" name="permissions" value="manage_mappings">
                            <label class="form-check-label" for="perm_manage_mappings">Eşleştirme Yönetimi</label>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="form-check mb-3">
                <input class="form-check-input" type="checkbox" id="isActive" name="isActive" checked>
                <label class="form-check-label" for="isActive">
                    Kullanıcı aktif olsun
                </label>
            </div>
            
            <div class="d-flex gap-2">
                <button type="submit" class="btn btn-primary">
                    <i class="bi bi-check"></i>
                    Kullanıcı Oluştur
                </button>
                <a href="/admin/users" class="btn btn-secondary">
                    <i class="bi bi-x"></i>
                    İptal
                </a>
            </div>
        </form>
    </div>
</div>

<script>
// Rol değişikliğinde izinleri otomatik ayarla
document.getElementById('role').addEventListener('change', function() {
    const role = this.value;
    const checkboxes = document.querySelectorAll('input[name="permissions"]');
    
    // Tüm izinleri temizle
    checkboxes.forEach(cb => cb.checked = false);
    
    // Rolle bağlı izinleri ayarla
    if (role === 'admin') {
        checkboxes.forEach(cb => cb.checked = true);
    } else if (role === 'manager') {
        ['read', 'write', 'manage_sources', 'manage_mappings'].forEach(perm => {
            const cb = document.querySelector(`input[value="${perm}"]`);
            if (cb) cb.checked = true;
        });
    } else if (role === 'user') {
        const readCb = document.querySelector('input[value="read"]');
        if (readCb) readCb.checked = true;
    }
});

// Şifre onayı kontrolü
document.getElementById('confirmPassword').addEventListener('blur', function() {
    const password = document.getElementById('password').value;
    const confirmPassword = this.value;
    
    if (password && confirmPassword && password !== confirmPassword) {
        this.setCustomValidity('Şifreler eşleşmiyor');
        this.classList.add('is-invalid');
    } else {
        this.setCustomValidity('');
        this.classList.remove('is-invalid');
    }
});
</script>